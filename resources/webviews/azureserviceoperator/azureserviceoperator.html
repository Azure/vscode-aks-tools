<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AKS Periscope</title>
    <!-- Link to the css file -->
    <link rel="stylesheet" href="{{cssuri}}">
    <script src="https://use.fontawesome.com/7dddd54b5c.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script>
        // https://code.visualstudio.com/api/extension-guides/webview#passing-messages-from-a-webview-to-an-extension
        const vscode = acquireVsCodeApi();

        $(document).ready(function () {
            $('.periscopeoutput').hide();

            $('#generatelink').click(function () {
                $(".spinner").show();
                vscode.postMessage({ command: "generateDownloadLink" });
                // https://docs.microsoft.com/en-us/rest/api/storageservices/setting-timeouts-for-blob-service-operations
                setTimeout(function() {$(".spinner").hide()}, 30000);
            });

            $(".toggle").click(function () {
                $('.allocatebody').toggle('slow');
            });

            $(".toggleoutput").click(function () {
                $('.periscopeoutput').toggle('slow');
            });

            $('.copy_text').click(function (e) {
                e.preventDefault();
                var copyText = $(this).attr('id');

                document.addEventListener('copy', function (e) {
                    e.clipboardData.setData('text/plain', copyText);
                    e.preventDefault();
                }, true);

                document.execCommand('copy');
            });
        });

    </script>
</head>

<body>
    <div class="heading">
        <h2 class="content-header">Azure Service Operator</h2>
        <br\> The Azure Service Operator comprises of:
        <br/>
        - The Custom Resource Definitions (CRDs) for each of the Azure services a Kubernetes user can provision.
        <br/>
        - The Kubernetes controller that watches for requests to create Custom Resources for each of these CRDs and creates them.
        <br/>
        To help you analyse and identify potential problems or easily share the information during the troubleshooting process.
            <a href="https://operatorhub.io/operator/azure-service-operator">Learn more</a></a>
    </div>


    {{#if (equalsZero outputCode)}}
    <div class="container">
        <div class="panel panel-default data-container">
            
        </div>
    </div>
    {{/if}}

    {{#if (isNonZeroNumber outputCode)}}
    <div class="critical">
        <i class="fa fa-times-circle" style="font-size:14px;color:red"></i>
        AKS Periscope failed to run on '{{name}}'. Please see the console output below for more details.
    </div>
    {{/if}}

    {{#if output}}
    <div class="container">
        <div class="panel panel-default data-container">
            <a class="toggleoutput" onclick="$('#collapsed-chevron-output').toggleClass('fa-rotate-180')"
                style="padding-top:5px;color:black;">
                <i class="fa fa-chevron-down" id="collapsed-chevron-output"
                    style="font-size:14px;padding-right:5px;;color:#605E5C;"></i>
                View Console Output
            </a>

            <div class="panel-body data-container-body periscopeoutput">
                <div><b>Cert Manager Output</b><br/>{{{breaklines certManagerOutput}}}</div>

                <div><b>Issuer Cert Output</b><br/>{{{breaklines issuerOutput}}}</div>

                <div><b>ASO Setting Apply Output</b><br/>{{{breaklines asoSettingsOutput}}}</div>

                <div><b>Operator pod output</b><br/>{{{breaklines output}}}</div>

            </div>
        </div>
    </div>
    {{/if}}
</body>

</html>